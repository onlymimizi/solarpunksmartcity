<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒºå—é“¾æ²»ç† - Solarpunk Smart City</title>
    <link rel="stylesheet" href="../components/ui.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
    <!-- é«˜ç§‘æŠ€èƒŒæ™¯ -->
    <div class="tech-background">
        <div class="grid-overlay"></div>
        <div class="floating-particles"></div>
        <div class="scan-lines"></div>
    </div>
    
    <div class="container" style="max-width: 1400px; margin: 0 auto; padding: 0 40px;">
        <div class="back-button-container">
            <a href="./index.html" class="back-button">â† è¿”å›ä¸»é¡µ</a>
        </div>
        
        <!-- é¡µé¢æ ‡é¢˜åŒºåŸŸ -->
        <div class="page-header" style="text-align: center; margin-bottom: 60px;">
            <div class="tech-badge">
                <div class="badge-glow"></div>
                <span class="badge-text">ğŸ”— BLOCKCHAIN GOVERNANCE MODULE</span>
            </div>
            <h1 style="margin: 30px 0 20px;">åŒºå—é“¾æ²»ç†</h1>
            <p style="font-size: 1.3rem; color: rgba(255, 255, 255, 0.8); max-width: 800px; margin: 0 auto;">
                å»ä¸­å¿ƒåŒ–æ•°æ®å­˜è¯ä¸æ™ºèƒ½åˆçº¦æ²»ç†å¹³å°
            </p>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ - å·¦å³å¸ƒå±€ -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 40px;">
        
        <!-- å·¦ä¾§ï¼šé’±åŒ…è¿æ¥ -->
        <div class="tech-module blockchain-module">
            <div class="module-header">
                <div class="module-status-bar">
                    <div class="status-indicator" id="wallet-status"></div>
                    <span class="status-text" id="wallet-status-text">WALLET DISCONNECTED</span>
                </div>
                <div class="module-id">WALLET</div>
            </div>
            
            <div class="module-icon-container">
                <div class="icon-background blockchain-bg"></div>
                <div class="module-icon">ğŸ‘›</div>
                <div class="icon-pulse blockchain-pulse"></div>
            </div>
            
            <div class="module-info">
                <h3 class="module-name">Web3é’±åŒ…è¿æ¥</h3>
                <p class="module-description">é€‰æ‹©Web3é’±åŒ…è¿æ¥åŒºå—é“¾ç½‘ç»œ</p>
            </div>
            
            <!-- é’±åŒ…é€‰æ‹©ç½‘æ ¼ -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin: 30px 0;">
                <button onclick="connectMetaMask()" class="tech-button wallet-button" style="padding: 12px 8px; font-size: 0.9rem;">
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <span style="font-size: 1.8rem; margin-bottom: 5px;">ğŸ¦Š</span>
                        <span class="button-text">MetaMask</span>
                    </div>
                </button>
                
                <button onclick="connectWalletConnect()" class="tech-button wallet-button" style="padding: 12px 8px; font-size: 0.9rem;">
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <span style="font-size: 1.8rem; margin-bottom: 5px;">ğŸ“±</span>
                        <span class="button-text">WalletConnect</span>
                    </div>
                </button>
                
                <button onclick="connectCoinbase()" class="tech-button wallet-button" style="padding: 12px 8px; font-size: 0.9rem;">
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <span style="font-size: 1.8rem; margin-bottom: 5px;">ğŸ”µ</span>
                        <span class="button-text">Coinbase</span>
                    </div>
                </button>
                
                <button onclick="connectTrust()" class="tech-button wallet-button" style="padding: 12px 8px; font-size: 0.9rem;">
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <span style="font-size: 1.8rem; margin-bottom: 5px;">ğŸ›¡ï¸</span>
                        <span class="button-text">Trust</span>
                    </div>
                </button>
                
                <button onclick="connectBinance()" class="tech-button wallet-button" style="padding: 12px 8px; font-size: 0.9rem;">
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <span style="font-size: 1.8rem; margin-bottom: 5px;">ğŸŸ¡</span>
                        <span class="button-text">Binance</span>
                    </div>
                </button>
                
                <button onclick="connectOKX()" class="tech-button wallet-button" style="padding: 12px 8px; font-size: 0.9rem;">
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <span style="font-size: 1.8rem; margin-bottom: 5px;">âš«</span>
                        <span class="button-text">OKX</span>
                    </div>
                </button>
            </div>
            
            <div style="text-align: center; font-size: 0.8rem; color: #666; margin-bottom: 20px;">
                æ”¯æŒä¸»æµWeb3é’±åŒ… | å®‰å…¨è¿æ¥ | ä¸€é”®åˆ‡æ¢
            </div>
            
            <div id="wallet-info" style="display: none; background: rgba(255, 152, 0, 0.1); border: 2px solid rgba(255, 152, 0, 0.3); border-radius: 15px; padding: 25px; margin-top: 20px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #ff9800; font-size: 0.9rem;">é’±åŒ…åœ°å€</label>
                        <div id="wallet-address" style="font-family: 'Courier New', monospace; font-size: 0.9rem; color: #ffcc02; word-break: break-all; background: rgba(255, 152, 0, 0.1); padding: 10px; border-radius: 8px;">æœªè¿æ¥</div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #ff9800; font-size: 0.9rem;">ç½‘ç»œ</label>
                        <div id="network-info" style="font-size: 1rem; color: #ffcc02; background: rgba(255, 152, 0, 0.1); padding: 10px; border-radius: 8px;">æœªè¿æ¥</div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #ff9800; font-size: 0.9rem;">ä½™é¢</label>
                        <div id="wallet-balance" style="font-size: 1rem; color: #ffcc02; background: rgba(255, 152, 0, 0.1); padding: 10px; border-radius: 8px;">0 ETH</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šæ•°æ®å­˜è¯ -->
        <div class="tech-module blockchain-module">
            <div class="module-header">
                <div class="module-status-bar">
                    <div class="status-indicator active"></div>
                    <span class="status-text">DATA STORAGE READY</span>
                </div>
                <div class="module-id">STORAGE</div>
            </div>
            
            <div class="module-icon-container">
                <div class="icon-background blockchain-bg"></div>
                <div class="module-icon">ğŸ’¾</div>
                <div class="icon-pulse blockchain-pulse"></div>
            </div>
            
            <div class="module-info">
                <h3 class="module-name">æ•°æ®å­˜è¯ç³»ç»Ÿ</h3>
                <p class="module-description">å°†é‡è¦æ•°æ®æ°¸ä¹…å­˜å‚¨åœ¨åŒºå—é“¾ä¸Š</p>
            </div>
            
            <div style="background: rgba(255, 152, 0, 0.1); border: 2px solid rgba(255, 152, 0, 0.3); border-radius: 15px; padding: 25px; margin: 30px 0;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                    <div>
                        <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #ff9800; font-size: 1rem; letter-spacing: 1px;">
                            ğŸ“„ æ•°æ®æ ‡é¢˜
                        </label>
                        <input id="data-title" type="text" placeholder="è¾“å…¥æ•°æ®æ ‡é¢˜" style="width: 100%; padding: 15px; font-size: 1.1rem; border: 2px solid rgba(255, 152, 0, 0.4); border-radius: 10px; background: rgba(255, 152, 0, 0.05); color: white;">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #ff9800; font-size: 1rem; letter-spacing: 1px;">
                            ğŸ·ï¸ æ•°æ®ç±»å‹
                        </label>
                        <select id="data-type" style="width: 100%; padding: 15px; font-size: 1.1rem; border: 2px solid rgba(255, 152, 0, 0.4); border-radius: 10px; background: rgba(255, 152, 0, 0.05); color: white;">
                            <option value="health">å¥åº·æ•°æ®</option>
                            <option value="traffic">äº¤é€šæ•°æ®</option>
                            <option value="city">åŸå¸‚æ•°æ®</option>
                            <option value="other">å…¶ä»–æ•°æ®</option>
                        </select>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #ff9800; font-size: 1rem; letter-spacing: 1px;">
                        ğŸ“ æ•°æ®å†…å®¹
                    </label>
                    <textarea id="data-content" rows="4" placeholder="è¾“å…¥è¦å­˜è¯çš„æ•°æ®å†…å®¹..." style="width: 100%; padding: 15px; font-size: 1.1rem; border: 2px solid rgba(255, 152, 0, 0.4); border-radius: 10px; background: rgba(255, 152, 0, 0.05); color: white; resize: vertical;"></textarea>
                </div>
                
                <div style="text-align: center; margin-top: 25px;">
                    <button id="store-data-btn" class="tech-button blockchain-button" style="width: auto; padding: 18px 40px; font-size: 1.2rem; min-width: 280px;" disabled>
                        <span class="button-text">ğŸ” å­˜å‚¨åˆ°åŒºå—é“¾</span>
                        <div class="button-arrow">â†’</div>
                        <div class="button-glow"></div>
                    </button>
                </div>
            </div>
        </div>
        
        </div> <!-- ç»“æŸå·¦å³å¸ƒå±€å®¹å™¨ -->

        <!-- åŒºå—é“¾ç»Ÿè®¡ -->
        <div class="tech-module blockchain-module">
            <div class="module-header">
                <div class="module-status-bar">
                    <div class="status-indicator active"></div>
                    <span class="status-text">BLOCKCHAIN STATS</span>
                </div>
                <div class="module-id">STATS</div>
            </div>
            
            <div class="module-icon-container">
                <div class="icon-background blockchain-bg"></div>
                <div class="module-icon">ğŸ“Š</div>
                <div class="icon-pulse blockchain-pulse"></div>
            </div>
            
            <div class="module-info">
                <h3 class="module-name">åŒºå—é“¾ç½‘ç»œç»Ÿè®¡</h3>
                <p class="module-description">å®æ—¶åŒºå—é“¾ç½‘ç»œçŠ¶æ€ä¸äº¤æ˜“ç»Ÿè®¡</p>
            </div>
            
            <!-- æŠ€æœ¯è§„æ ¼ -->
            <div class="tech-specs">
                <div class="spec-item">
                    <span class="spec-label">NETWORK</span>
                    <span class="spec-value">Web3</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">TXN</span>
                    <span class="spec-value" id="total-transactions">47,293</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">SECURITY</span>
                    <span class="spec-value">100%</span>
                </div>
            </div>
            
            <!-- ç»Ÿè®¡æ•°æ® -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
                <div style="background: rgba(255, 152, 0, 0.1); border: 2px solid rgba(255, 152, 0, 0.3); border-radius: 15px; padding: 20px; text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">â›“ï¸</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #ff9800; margin-bottom: 5px;" id="block-height">18,547,293</div>
                    <div style="font-size: 0.9rem; color: #ffcc02;">å½“å‰åŒºå—é«˜åº¦</div>
                </div>
                
                <div style="background: rgba(255, 152, 0, 0.1); border: 2px solid rgba(255, 152, 0, 0.3); border-radius: 15px; padding: 20px; text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">â›½</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #ff9800; margin-bottom: 5px;" id="gas-price">25</div>
                    <div style="font-size: 0.9rem; color: #ffcc02;">Gasä»·æ ¼ Gwei</div>
                </div>
                
                <div style="background: rgba(255, 152, 0, 0.1); border: 2px solid rgba(255, 152, 0, 0.3); border-radius: 15px; padding: 20px; text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ”</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #ff9800; margin-bottom: 5px;" id="stored-records">1,247</div>
                    <div style="font-size: 0.9rem; color: #ffcc02;">å·²å­˜è¯è®°å½•</div>
                </div>
                
                <div style="background: rgba(255, 152, 0, 0.1); border: 2px solid rgba(255, 152, 0, 0.3); border-radius: 15px; padding: 20px; text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ‘¥</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #ff9800; margin-bottom: 5px;" id="active-users">8,432</div>
                    <div style="font-size: 0.9rem; color: #ffcc02;">æ´»è·ƒç”¨æˆ·</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let provider = null;
        let signer = null;
        let userAddress = null;
        
        // é€šç”¨é’±åŒ…è¿æ¥å‡½æ•°
        async function connectWalletGeneric(walletName, provider) {
            try {
                const accounts = await provider.request({ method: 'eth_requestAccounts' });
                window.provider = new ethers.providers.Web3Provider(provider);
                signer = window.provider.getSigner();
                userAddress = accounts[0];
                
                // æ›´æ–°UI
                document.getElementById('wallet-status').classList.add('active');
                document.getElementById('wallet-status-text').textContent = `${walletName.toUpperCase()} CONNECTED`;
                document.getElementById('wallet-address').textContent = userAddress;
                document.getElementById('wallet-info').style.display = 'block';
                document.getElementById('store-data-btn').disabled = false;
                
                // è·å–ç½‘ç»œä¿¡æ¯
                const network = await window.provider.getNetwork();
                document.getElementById('network-info').textContent = network.name || `Chain ID: ${network.chainId}`;
                
                // è·å–ä½™é¢
                const balance = await window.provider.getBalance(userAddress);
                document.getElementById('wallet-balance').textContent = `${ethers.utils.formatEther(balance).substring(0, 8)} ETH`;
                
                // ç¦ç”¨æ‰€æœ‰é’±åŒ…æŒ‰é’®
                const walletButtons = document.querySelectorAll('.wallet-button');
                walletButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                });
                
                console.log(`âœ… ${walletName} é’±åŒ…è¿æ¥æˆåŠŸ`);
                
            } catch (error) {
                console.error(`è¿æ¥${walletName}é’±åŒ…å¤±è´¥:`, error);
                alert(`è¿æ¥${walletName}é’±åŒ…å¤±è´¥ï¼Œè¯·ç¡®ä¿å·²å®‰è£…å¯¹åº”é’±åŒ…`);
            }
        }
        
        // MetaMaskè¿æ¥
        async function connectMetaMask() {
            if (typeof window.ethereum !== 'undefined' && window.ethereum.isMetaMask) {
                await connectWalletGeneric('MetaMask', window.ethereum);
            } else {
                alert('è¯·å®‰è£…MetaMaské’±åŒ…\
ä¸‹è½½åœ°å€: https://metamask.io/');
            }
        }
        
        // WalletConnectè¿æ¥
        async function connectWalletConnect() {
            try {
                // æ£€æŸ¥æ˜¯å¦æœ‰WalletConnectæä¾›è€…
                if (typeof window.WalletConnect !== 'undefined') {
                    // è¿™é‡Œéœ€è¦WalletConnectåº“çš„å®é™…å®ç°
                    alert('WalletConnectåŠŸèƒ½å¼€å‘ä¸­\
è¯·ä½¿ç”¨MetaMaskæˆ–å…¶ä»–æµè§ˆå™¨é’±åŒ…');
                } else {
                    alert('WalletConnectåŠŸèƒ½å¼€å‘ä¸­\
è¯·ä½¿ç”¨MetaMaskæˆ–å…¶ä»–æµè§ˆå™¨é’±åŒ…');
                }
            } catch (error) {
                console.error('WalletConnectè¿æ¥å¤±è´¥:', error);
                alert('WalletConnectè¿æ¥å¤±è´¥');
            }
        }
        
        // Coinbase Walletè¿æ¥
        async function connectCoinbase() {
            if (typeof window.ethereum !== 'undefined' && window.ethereum.isCoinbaseWallet) {
                await connectWalletGeneric('Coinbase', window.ethereum);
            } else if (typeof window.coinbaseWalletExtension !== 'undefined') {
                await connectWalletGeneric('Coinbase', window.coinbaseWalletExtension);
            } else {
                alert('è¯·å®‰è£…Coinbase Wallet\
ä¸‹è½½åœ°å€: https://wallet.coinbase.com/');
            }
        }
        
        // Trust Walletè¿æ¥
        async function connectTrust() {
            if (typeof window.ethereum !== 'undefined' && window.ethereum.isTrust) {
                await connectWalletGeneric('Trust Wallet', window.ethereum);
            } else {
                alert('è¯·å®‰è£…Trust Wallet\
ä¸‹è½½åœ°å€: https://trustwallet.com/');
            }
        }
        
        // Binance Chain Walletè¿æ¥
        async function connectBinance() {
            if (typeof window.BinanceChain !== 'undefined') {
                await connectWalletGeneric('Binance Wallet', window.BinanceChain);
            } else {
                alert('è¯·å®‰è£…Binance Chain Wallet\
ä¸‹è½½åœ°å€: https://www.binance.org/en');
            }
        }
        
        // OKX Walletè¿æ¥
        async function connectOKX() {
            if (typeof window.okxwallet !== 'undefined') {
                await connectWalletGeneric('OKX Wallet', window.okxwallet);
            } else if (typeof window.ethereum !== 'undefined' && window.ethereum.isOkxWallet) {
                await connectWalletGeneric('OKX Wallet', window.ethereum);
            } else {
                alert('è¯·å®‰è£…OKX Wallet\
ä¸‹è½½åœ°å€: https://www.okx.com/web3');
            }
        }
        
        // å­˜å‚¨æ•°æ®åˆ°åŒºå—é“¾ï¼ˆæ¨¡æ‹Ÿï¼‰
        async function storeDataToBlockchain() {
            const title = document.getElementById('data-title').value;
            const type = document.getElementById('data-type').value;
            const content = document.getElementById('data-content').value;
            
            if (!title || !content) {
                alert('è¯·å¡«å†™å®Œæ•´çš„æ•°æ®ä¿¡æ¯');
                return;
            }
            
            if (!signer) {
                alert('è¯·å…ˆè¿æ¥é’±åŒ…');
                return;
            }
            
            try {
                // æ¨¡æ‹ŸåŒºå—é“¾äº¤æ˜“
                const btn = document.getElementById('store-data-btn');
                const originalText = btn.querySelector('.button-text').textContent;
                btn.querySelector('.button-text').textContent = 'â³ å­˜å‚¨ä¸­...';
                btn.disabled = true;
                
                // æ¨¡æ‹Ÿäº¤æ˜“å»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // æ¸…ç©ºè¡¨å•
                document.getElementById('data-title').value = '';
                document.getElementById('data-content').value = '';
                
                // æ›´æ–°UI
                btn.querySelector('.button-text').textContent = originalText;
                btn.disabled = false;
                
                alert('æ•°æ®å·²æˆåŠŸå­˜å‚¨åˆ°åŒºå—é“¾ï¼\näº¤æ˜“å“ˆå¸Œ: 0x' + Math.random().toString(16).substr(2, 64));
                
            } catch (error) {
                console.error('å­˜å‚¨å¤±è´¥:', error);
                alert('å­˜å‚¨å¤±è´¥ï¼Œè¯·é‡è¯•');
                
                const btn = document.getElementById('store-data-btn');
                btn.querySelector('.button-text').textContent = 'ğŸ” å­˜å‚¨åˆ°åŒºå—é“¾';
                btn.disabled = false;
            }
        }
        
        // æ›´æ–°åŒºå—é“¾ç»Ÿè®¡æ•°æ®
        function updateBlockchainStats() {
            // æ¨¡æ‹Ÿå®æ—¶æ•°æ®æ›´æ–°
            const baseHeight = 18547293;
            const currentHeight = baseHeight + Math.floor(Math.random() * 100);
            document.getElementById('block-height').textContent = currentHeight.toLocaleString();
            
            const gasPrice = 20 + Math.floor(Math.random() * 20);
            document.getElementById('gas-price').textContent = gasPrice;
            
            const totalTxn = 47293 + Math.floor(Math.random() * 1000);
            document.getElementById('total-transactions').textContent = totalTxn.toLocaleString();
            
            const storedRecords = 1247 + Math.floor(Math.random() * 100);
            document.getElementById('stored-records').textContent = storedRecords.toLocaleString();
            
            const activeUsers = 8432 + Math.floor(Math.random() * 500);
            document.getElementById('active-users').textContent = activeUsers.toLocaleString();
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šå­˜å‚¨æŒ‰é’®
            document.getElementById('store-data-btn').addEventListener('click', storeDataToBlockchain);
            
            // å¯åŠ¨ç»Ÿè®¡æ•°æ®æ›´æ–°
            updateBlockchainStats();
            setInterval(updateBlockchainStats, 5000);
            
            // æ£€æµ‹å·²å®‰è£…çš„é’±åŒ…
            detectInstalledWallets();
        });
        
        // æ£€æµ‹å·²å®‰è£…çš„é’±åŒ…
        function detectInstalledWallets() {
            const walletStatus = {
                metamask: typeof window.ethereum !== 'undefined' && window.ethereum.isMetaMask,
                coinbase: typeof window.ethereum !== 'undefined' && window.ethereum.isCoinbaseWallet,
                trust: typeof window.ethereum !== 'undefined' && window.ethereum.isTrust,
                binance: typeof window.BinanceChain !== 'undefined',
                okx: typeof window.okxwallet !== 'undefined' || (typeof window.ethereum !== 'undefined' && window.ethereum.isOkxWallet)
            };
            
            console.log('æ£€æµ‹åˆ°çš„é’±åŒ…:', walletStatus);
        }
    </script>
</body>
</html>