<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D City Visualization - Solarpunk Smart City</title>
    <link rel="stylesheet" href="../components/ui.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <!-- High-tech background -->
    <div class="tech-background">
        <div class="grid-overlay"></div>
        <div class="floating-particles"></div>
        <div class="scan-lines"></div>
    </div>
    
    <div class="container" style="max-width: 1400px; margin: 0 auto; padding: 0 40px;">
        <div class="back-button-container">
            <a href="./index-en.html" class="back-button">‚Üê Back to Home</a>
        </div>
        
        <div class="page-header">
            <h1 class="page-title">üèôÔ∏è 3D City Visualization</h1>
            <p class="page-subtitle">Immersive Solarpunk City Experience with Real-time Rendering</p>
        </div>
        
        <!-- 3D Canvas Container -->
        <div class="city-canvas-container">
            <canvas id="cityCanvas" class="city-canvas"></canvas>
            <div class="canvas-overlay">
                <div class="city-info-panel">
                    <h3>City Statistics</h3>
                    <div class="city-stats">
                        <div class="stat-item">
                            <span class="stat-label">Buildings:</span>
                            <span class="stat-value">2,847</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Green Spaces:</span>
                            <span class="stat-value">156</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Solar Panels:</span>
                            <span class="stat-value">12,450</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Energy Efficiency:</span>
                            <span class="stat-value">98.7%</span>
                        </div>
                    </div>
                </div>
                
                <div class="city-controls">
                    <button class="control-btn" onclick="resetCamera()">Reset View</button>
                    <button class="control-btn" onclick="toggleAnimation()">Toggle Animation</button>
                    <button class="control-btn" onclick="changeTimeOfDay()">Day/Night</button>
                </div>
            </div>
        </div>
        
        <!-- Feature Description -->
        <div class="feature-description">
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">üå±</div>
                    <h3>Sustainable Architecture</h3>
                    <p>Green buildings with integrated solar panels and vertical gardens</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üîã</div>
                    <h3>Smart Energy Grid</h3>
                    <p>Distributed renewable energy network with AI optimization</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üöÅ</div>
                    <h3>Aerial Transportation</h3>
                    <p>Flying vehicles and drone delivery systems integration</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üíß</div>
                    <h3>Water Management</h3>
                    <p>Rainwater harvesting and smart irrigation systems</p>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/enhanced-city-renderer.js"></script>
    <script>
        // Initialize 3D city scene
        let scene, camera, renderer, cityGroup;
        let isAnimating = true;
        let isDayTime = true;
        
        function initCity() {
            // Scene setup
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x87CEEB, 50, 200);
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(50, 30, 50);
            camera.lookAt(0, 0, 0);
            
            // Renderer setup
            const canvas = document.getElementById('cityCanvas');
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(canvas.offsetWidth, canvas.offsetHeight);
            renderer.setClearColor(0x87CEEB);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 50, 25);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Create city
            createSolarpunkCity();
            
            // Animation loop
            animate();
        }
        
        function createSolarpunkCity() {
            cityGroup = new THREE.Group();
            
            // Create buildings with solar panels
            for (let i = 0; i < 50; i++) {
                const building = createSolarpunkBuilding();
                const x = (Math.random() - 0.5) * 100;
                const z = (Math.random() - 0.5) * 100;
                building.position.set(x, 0, z);
                cityGroup.add(building);
            }
            
            // Add green spaces
            for (let i = 0; i < 20; i++) {
                const park = createGreenSpace();
                const x = (Math.random() - 0.5) * 80;
                const z = (Math.random() - 0.5) * 80;
                park.position.set(x, 0, z);
                cityGroup.add(park);
            }
            
            scene.add(cityGroup);
        }
        
        function createSolarpunkBuilding() {
            const group = new THREE.Group();
            
            // Building base
            const height = Math.random() * 20 + 10;
            const geometry = new THREE.BoxGeometry(4, height, 4);
            const material = new THREE.MeshLambertMaterial({ 
                color: new THREE.Color().setHSL(0.3, 0.3, 0.7) 
            });
            const building = new THREE.Mesh(geometry, material);
            building.position.y = height / 2;
            building.castShadow = true;
            building.receiveShadow = true;
            group.add(building);
            
            // Solar panels on roof
            const panelGeometry = new THREE.BoxGeometry(3.8, 0.1, 3.8);
            const panelMaterial = new THREE.MeshLambertMaterial({ color: 0x1a1a2e });
            const solarPanel = new THREE.Mesh(panelGeometry, panelMaterial);
            solarPanel.position.y = height + 0.1;
            group.add(solarPanel);
            
            // Green elements
            const leafGeometry = new THREE.SphereGeometry(0.5, 8, 6);
            const leafMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
            for (let i = 0; i < 3; i++) {
                const leaf = new THREE.Mesh(leafGeometry, leafMaterial);
                leaf.position.set(
                    (Math.random() - 0.5) * 3,
                    Math.random() * height,
                    (Math.random() - 0.5) * 3
                );
                group.add(leaf);
            }
            
            return group;
        }
        
        function createGreenSpace() {
            const group = new THREE.Group();
            
            // Ground
            const groundGeometry = new THREE.CircleGeometry(5, 16);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x90EE90 });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            group.add(ground);
            
            // Trees
            for (let i = 0; i < 5; i++) {
                const tree = createTree();
                const angle = (i / 5) * Math.PI * 2;
                tree.position.set(
                    Math.cos(angle) * 3,
                    0,
                    Math.sin(angle) * 3
                );
                group.add(tree);
            }
            
            return group;
        }
        
        function createTree() {
            const group = new THREE.Group();
            
            // Trunk
            const trunkGeometry = new THREE.CylinderGeometry(0.2, 0.3, 3);
            const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            trunk.position.y = 1.5;
            group.add(trunk);
            
            // Leaves
            const leavesGeometry = new THREE.SphereGeometry(2, 8, 6);
            const leavesMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
            const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);
            leaves.position.y = 4;
            group.add(leaves);
            
            return group;
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (isAnimating && cityGroup) {
                cityGroup.rotation.y += 0.005;
            }
            
            renderer.render(scene, camera);
        }
        
        function resetCamera() {
            camera.position.set(50, 30, 50);
            camera.lookAt(0, 0, 0);
        }
        
        function toggleAnimation() {
            isAnimating = !isAnimating;
        }
        
        function changeTimeOfDay() {
            isDayTime = !isDayTime;
            if (isDayTime) {
                scene.fog.color.setHex(0x87CEEB);
                renderer.setClearColor(0x87CEEB);
            } else {
                scene.fog.color.setHex(0x191970);
                renderer.setClearColor(0x191970);
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initCity);
        
        // Handle window resize
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('cityCanvas');
            camera.aspect = canvas.offsetWidth / canvas.offsetHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(canvas.offsetWidth, canvas.offsetHeight);
        });
    </script>
</body>
</html>